<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - SGMRP</title>
    <meta name="description" content="Acesse o Sistema de Gerenciamento de Mapas de Refei√ß√µes Penitenci√°rio">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        .alert {
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            line-height: 1.25rem;
            border: 1px solid;
        }
        
        .alert-danger {
            color: #dc2626;
            background-color: #fef2f2;
            border-color: #fecaca;
        }
        
        .alert-success {
            color: #16a34a;
            background-color: #dcfce7;
            border-color: #bbf7d0;
        }
        
        .alert-warning {
            color: #d97706;
            background-color: #fef3c7;
            border-color: #fed7aa;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        #flashMessage {
            animation: slideIn 0.3s ease-out;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="{{ url_for('index') }}" class="logo">SGMRP</a>
                <nav>
                    <ul>
                        <li><a href="{{ url_for('index') }}">In√≠cio</a></li>
                        <li><a href="{{ url_for('login') }}" class="active">Login</a></li>
                        <li><a href="{{ url_for('cadastro') }}">Cadastro</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <div class="container" style="max-width: 500px; margin-top: 2rem;">
            <!-- Breadcrumb -->
            <nav aria-label="Navega√ß√£o">
                <ol style="display: flex; gap: 0.5rem; margin-bottom: 2rem; font-size: 0.875rem; color: var(--gray-500);">
                    <li><a href="{{ url_for('index') }}" style="color: var(--primary-color); text-decoration: none;">In√≠cio</a></li>
                    <li aria-hidden="true">/</li>
                    <li aria-current="page">Login</li>
                </ol>
            </nav>

            <div class="card fade-in">
                <div class="card-body" style="padding: 3rem;">
                    <!-- Header do Login -->
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; font-size: 2rem; color: white;">
                            üîê
                        </div>
                        <h1 style="margin-bottom: 0.5rem;">Acesso ao Sistema</h1>
                        <p style="color: var(--gray-600); margin-bottom: 0;">
                            Entre com suas credenciais para acessar o SGMRP
                        </p>
                    </div>

                    <!-- Mensagens de Erro/Sucesso -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            {% for category, message in messages %}
                                <div class="alert alert-{{ 'danger' if category == 'error' else 'success' if category == 'success' else 'warning' }}" 
                                     id="flashMessage" 
                                     style="margin-bottom: 1.5rem; animation: slideIn 0.3s ease-out; position: relative; display: flex; align-items: center; justify-content: space-between;">
                                    <div>
                                        <strong>
                                            {% if category == 'error' %}‚ö†Ô∏è Erro:{% endif %}
                                            {% if category == 'success' %}‚úÖ Sucesso:{% endif %}
                                            {% if category == 'warning' %}‚ö†Ô∏è Aten√ß√£o:{% endif %}
                                        </strong>
                                        {{ message }}
                                    </div>
                                    <button type="button" 
                                            onclick="this.parentElement.style.display='none'" 
                                            style="background: none; border: none; font-size: 1.2rem; cursor: pointer; padding: 0; margin-left: 1rem; opacity: 0.6; line-height: 1;">
                                        √ó
                                    </button>
                                </div>
                            {% endfor %}
                        {% endif %}
                    {% endwith %}

                    <!-- Formul√°rio de Login -->
                    <form id="loginForm" method="POST" action="{{ url_for('login') }}" novalidate>
                        <div class="form-group">
                            <label for="usuario" class="form-label">
                                Usu√°rio ou E-mail <span style="color: var(--danger-color);">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="usuario" 
                                name="email" 
                                class="form-input" 
                                placeholder="Digite seu usu√°rio ou e-mail"
                                required
                                autocomplete="username"
                                aria-describedby="usuario-error"
                            >
                            <div id="usuario-error" class="error-message" style="display: none; color: var(--danger-color); font-size: 0.875rem; margin-top: 0.25rem;"></div>
                        </div>

                        <div class="form-group">
                            <label for="senha" class="form-label">
                                Senha <span style="color: var(--danger-color);">*</span>
                            </label>
                            <div style="position: relative;">
                                <input 
                                    type="password" 
                                    id="senha" 
                                    name="senha" 
                                    class="form-input" 
                                    placeholder="Digite sua senha"
                                    required
                                    autocomplete="current-password"
                                    aria-describedby="senha-error"
                                    style="padding-right: 3rem;"
                                >
                                <button 
                                    type="button" 
                                    id="toggleSenha"
                                    style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; color: var(--gray-500); cursor: pointer; padding: 0.25rem;"
                                    aria-label="Mostrar/ocultar senha"
                                >
                                    üëÅÔ∏è
                                </button>
                            </div>
                            <div id="senha-error" class="error-message" style="display: none; color: var(--danger-color); font-size: 0.875rem; margin-top: 0.25rem;"></div>
                        </div>

                        <!-- Checkbox "Lembrar-me" -->
                        <div style="display: flex; align-items: center; margin-bottom: 1.5rem;">
                            <input 
                                type="checkbox" 
                                id="lembrarMe" 
                                name="lembrarMe"
                                style="margin-right: 0.5rem;"
                            >
                            <label for="lembrarMe" style="font-size: 0.875rem; color: var(--gray-600); cursor: pointer;">
                                Manter-me conectado
                            </label>
                        </div>

                        <!-- Bot√£o de Login -->
                        <button type="submit" class="btn btn-primary" style="width: 100%; margin-bottom: 1rem;" id="loginButton">
                            <span id="loginButtonText">Entrar no Sistema</span>
                            <span id="loginButtonSpinner" style="display: none;">Entrando...</span>
                        </button>

                        <!-- Link para recuperar senha -->
                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <a href="#" style="color: var(--primary-color); font-size: 0.875rem; text-decoration: none;" id="esqueceuSenha">
                                Esqueceu sua senha?
                            </a>
                        </div>
                    </form>

                    <!-- Divisor -->
                    <div style="text-align: center; margin: 1.5rem 0; position: relative;">
                        <hr style="border: none; border-top: 1px solid var(--gray-200);">
                        <span style="background-color: white; color: var(--gray-500); padding: 0 1rem; position: absolute; top: -0.5rem; left: 50%; transform: translateX(-50%); font-size: 0.875rem;">
                            N√£o tem uma conta?
                        </span>
                    </div>

                    <!-- Link para Cadastro -->
                    <div style="text-align: center;">
                        <a href="{{ url_for('cadastro') }}" class="btn btn-secondary" style="width: 100%;">
                            Criar Nova Conta
                        </a>
                    </div>
                </div>
            </div>

            <!-- Informa√ß√µes de Acesso -->
            <div class="alert alert-info" style="margin-top: 2rem;">
                <h4 style="margin-bottom: 0.5rem;">Acesso Restrito</h4>
                <p style="margin-bottom: 0.5rem; font-size: 0.875rem;">
                    Este sistema √© destinado exclusivamente para funcion√°rios autorizados da SFA, 
                    supervisores, gestores do sistema penitenci√°rio e auditores credenciados.
                </p>
                <p style="margin-bottom: 0; font-size: 0.875rem;">
                    <strong>Para obter acesso:</strong> Entre em contato com o administrador do sistema 
                    ou respons√°vel pela √°rea de TI da sua unidade.
                </p>
            </div>

            <!-- Informa√ß√µes T√©cnicas -->
            <div class="card" style="margin-top: 1rem;">
                <div class="card-body" style="padding: 1.5rem;">
                    <h5 style="margin-bottom: 1rem;">Requisitos do Sistema</h5>
                    <ul style="font-size: 0.875rem; color: var(--gray-600); margin: 0; padding-left: 1.25rem;">
                        <li>Navegadores suportados: Chrome, Firefox, Safari, Edge (√∫ltimas 2 vers√µes)</li>
                        <li>JavaScript deve estar habilitado</li>
                        <li>Resolu√ß√£o m√≠nima recomendada: 1024x768</li>
                        <li>Conex√£o com a internet necess√°ria</li>
                    </ul>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <div class="container text-center">
            <p style="margin: 0; color: var(--gray-400); font-size: 0.875rem;">
                ¬© 2025 SGMRP - Sistema de Gerenciamento de Mapas de Refei√ß√µes Penitenci√°rio
            </p>
        </div>
    </footer>

    <script>
        // Toggle para mostrar/ocultar senha
        document.getElementById('toggleSenha').addEventListener('click', function() {
            const senhaInput = document.getElementById('senha');
            const toggleButton = document.getElementById('toggleSenha');
            
            if (senhaInput.type === 'password') {
                senhaInput.type = 'text';
                toggleButton.textContent = 'üôà';
                toggleButton.setAttribute('aria-label', 'Ocultar senha');
            } else {
                senhaInput.type = 'password';
                toggleButton.textContent = 'üëÅÔ∏è';
                toggleButton.setAttribute('aria-label', 'Mostrar senha');
            }
        });

        // Valida√ß√£o do formul√°rio
        function validateForm() {
            let isValid = true;
            const usuario = document.getElementById('usuario');
            const senha = document.getElementById('senha');
            
            // Limpar erros anteriores
            clearErrors();
            
            // Validar usu√°rio
            if (!usuario.value.trim()) {
                showError('usuario', 'O nome de usu√°rio √© obrigat√≥rio');
                isValid = false;
            } else if (usuario.value.trim().length < 3) {
                showError('usuario', 'O nome de usu√°rio deve ter pelo menos 3 caracteres');
                isValid = false;
            }
            
            // Validar senha
            if (!senha.value) {
                showError('senha', 'A senha √© obrigat√≥ria');
                isValid = false;
            } else if (senha.value.length < 4) {
                showError('senha', 'A senha deve ter pelo menos 4 caracteres');
                isValid = false;
            }
            
            return isValid;
        }

        function showError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const errorDiv = document.getElementById(fieldId + '-error');
            
            field.classList.add('error');
            field.style.borderColor = 'var(--danger-color)';
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function clearErrors() {
            const fields = ['usuario', 'senha'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                const errorDiv = document.getElementById(fieldId + '-error');
                
                field.classList.remove('error');
                field.style.borderColor = '';
                errorDiv.style.display = 'none';
                errorDiv.textContent = '';
            });
        }

        // Limpar erros quando o usu√°rio come√ßa a digitar
        document.getElementById('usuario').addEventListener('input', function() {
            if (this.value.trim()) {
                this.style.borderColor = '';
                document.getElementById('usuario-error').style.display = 'none';
            }
        });

        document.getElementById('senha').addEventListener('input', function() {
            if (this.value) {
                this.style.borderColor = '';
                document.getElementById('senha-error').style.display = 'none';
            }
        });

        // Submiss√£o do formul√°rio
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            // Validar campos antes de enviar
            if (!validateForm()) {
                e.preventDefault();
                return false;
            }
            
            // Salvar dados de "lembrar-me" antes do envio
            const usuario = document.getElementById('usuario').value;
            if (document.getElementById('lembrarMe').checked) {
                localStorage.setItem('sgmrp_remember', 'true');
                localStorage.setItem('sgmrp_usuario', usuario);
            } else {
                localStorage.removeItem('sgmrp_remember');
                localStorage.removeItem('sgmrp_usuario');
            }
            
            // Mostrar estado de loading
            const button = document.getElementById('loginButton');
            const buttonText = document.getElementById('loginButtonText');
            const buttonSpinner = document.getElementById('loginButtonSpinner');
            
            button.disabled = true;
            buttonText.style.display = 'none';
            buttonSpinner.style.display = 'inline';
            
            // Permitir que o formul√°rio seja enviado normalmente para o Flask
            // O Flask ir√° processar e fazer o redirecionamento
        });

        // Verificar se existe dados salvos para "lembrar-me"
        window.addEventListener('load', function() {
            if (localStorage.getItem('sgmrp_remember') === 'true') {
                const usuarioSalvo = localStorage.getItem('sgmrp_usuario');
                if (usuarioSalvo) {
                    document.getElementById('usuario').value = usuarioSalvo;
                    document.getElementById('lembrarMe').checked = true;
                }
            }
        });

        // Auto-esconder mensagens flash ap√≥s 5 segundos
        const flashMessage = document.getElementById('flashMessage');
        if (flashMessage) {
            setTimeout(() => {
                flashMessage.style.transition = 'opacity 0.5s ease-out, transform 0.5s ease-out';
                flashMessage.style.opacity = '0';
                flashMessage.style.transform = 'translateY(-20px)';
                
                setTimeout(() => {
                    flashMessage.style.display = 'none';
                }, 500);
            }, 5000);
        }

        // Link "Esqueceu sua senha?"
        document.getElementById('esqueceuSenha').addEventListener('click', function(e) {
            e.preventDefault();
            alert('Funcionalidade de recupera√ß√£o de senha ser√° implementada em vers√µes futuras.\n\nPor enquanto, entre em contato com o administrador do sistema para redefinir sua senha.');
        });

        // Anima√ß√£o de fade-in
        document.querySelectorAll('.fade-in').forEach(el => {
            el.style.opacity = '0';
            el.style.transform = 'translateY(30px)';
            el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            
            // Trigger animation
            setTimeout(() => {
                el.style.opacity = '1';
                el.style.transform = 'translateY(0)';
            }, 100);
        });
    </script>
</body>
</html>
